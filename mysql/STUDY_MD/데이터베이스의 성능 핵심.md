# 데이터베이스의 성능 핵심

CPU가 데이터를 가져오거나 저장할려면 I/O 입출력 버스를 이용하고, 디스크나 모니터로 보낸다.

여기서 **데이터를 저장**하기 위해서 어떤걸 사용할까? 
- 메모리, 디스크

###### 메모리, 디스크 비교
|     | 메모리             | 디스크     |
|-----|-----------------|---------|
| 속도  | 빠름              | 느림      |
| 영속성 | 전원이 공급되지 않으면 휘발 | 영속성이 있음 |
| 가격  | 비쌈              | 저렴함     |

- 디스크는 메모리에 비해 속도가 느리지만
- 결국 데이터는 디스크에 저장된다
  - **결국 DB 성능의 핵심은 디스크 I/O(접근)을 최소화 하는 것!**


### 디스크 접근을 어떻게 줄일 수 있을까? 
- 메모리에 올라온 데이터로 최대한 요청을 처리하는 것
  - -> 메모리 캐시 히트율을 높이는 것

    
- 심지어 쓰기도 곧 바로 디스크에 쓰지 않고 메모리에 쓴다.
  - 메모리에 **데이터 유실을 고려해 WAL(Write Ahead Log)를 사용**
    

##### WAL 이란

- 디스크 접근 방식에는 랜덤 I/O와 순차 I/O 가 있다!
![random-sequential-IO.png](..%2FIMAGE%2Frandom-sequential-IO.png)


- 대부분의 트랜잭션은 무작위하게 Write가 발생
  - 이를 지연시켜 랜덤 I/O 횟수를 줄이는 대신 **순차적 I/O를 발생시켜 정합성 유지**
  - 로그 파일에 순차적으로 남아서 메모리에 디스크가 가지않고 날라가도 서버가 다시 뜰때 순차적으로 쌓아 놓아던 데이터를 다시 실행시킨다!

- WAL의 중심 개념은 변경을 로깅한 후에만, 
- 즉 변경 내용을 설명하는 로그 레코드를 영구적 저장소에 먼저 기록한 후에 데이터 파일(테이블과 인덱스가 있는)의 변경 내용을 작성해야 한다는 것이다. 
- 이 절차를 준수한 경우 충돌 발생 시 로그를 사용하여 데이터베이스를 복수할 수 있으므로 트랜잭션 커밋마다 데이터 페이지를 디스크에 쓸 필요가 없다.

[메모리와 디스크의 속도차이 설명](https://colin-scott.github.io/personal_website/research/interactive_latency.html)


> 결국 데이터베이스 성능의 핵심은 **디스크 랜덤 I/O(접근)을 최소화 하는 것**!