# 실무에서의 정규화, 비정규화에 대한 고민들

테이블을 만들때면 항상 고민
- 이 데이터 어디 테이블에 있었는데..


### 중복된 데이터이면 반드시 정규화를 해야하는 걸까? 

- 사실 실무에서 중복 데이터면 기계적으로 정규화 하는 분들이 종종있다.(토스 개발자님도 그랬다.)
- **정규화도 비용이다.** 읽기 비용을 지불하고 쓰기 비용을 줄이는 것

## 정규화시 고려해야 하는 것
- 얼마나 빠르게 데이터의 최신성을 보장해야 하는가?
  - 매번 참조해서 가는 것도 부하
  - 데이터 일관성과 최신성을 덜 보장된다면, 오히려 읽기시의 성능을 더 누릴 수 있다.
      - 보통 웹사이트들을 보면 읽기와 쓰기의 비율을 보면 읽기가 압도적으로 많다!
- 히스토리성 데이터들은 정규화를 하면 안된다!
- 데이터 변경 주기와 조회 주기는 어떻게 되는가?
  - 변경주기보다 조회 주기가 더 빈번하다면 쓰기의 이점을 가져가야한다!
  - 반대의 경우에는 읽기의 이점을 가져가게 
- 객체(테이블) 탐색 깊이가 얼마나 깊은가
  - e.x. A-> B -> C -> D 
  - A 정보를 알고있을 때 D 정보를 가지고 오고 싶을때 너무 깊고 조인으로 하면 너무 무거울 것 같다.
  - 이럴때 B 테이블에 D 테이블을 참조하게 만든다. ( A -> B -> D , A -> B-> C -> D)
    - 이러면 C의 D 참조가 변경될 경우, B의 D 참조도 같이 변경되어야 한다.


## 정규화를 하기로 했다면, 읽기시 데이터를 어떻게 가져올 것인가?

- 테이블 조인을 많이 활용하는데, **이는 사실 고민해볼 문제다.**
- **테이블 조인은 서로 다른 테이블의 결합도를 엄청나게 높인다**
  - 하나의 테이블의 변경이 일어날 때 여러 테이블 영향
  - FK가 걸려있으면 MySQL에서는 데드락 이슈가 발생할 수 있음
- 조회시에는 성능이 좋은 별도 DB나 캐싱등 다양한 최적화 기법을 이용할 수있다. (CQRS)
- 조인을 사용하게 되면, 이런 기법들을 사용하는데 제한이 있거나 더 많은 리소스가 들 수 있다.
- 읽기 쿼리 한번 더 발생되는 것은 그렇게 큰 부담이 아닐 수 있다.
- 하지만 조인이 좋을 때도 있다.

